<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/styles/css.css}" rel="stylesheet"/>
    <link th:href="@{/styles/modal.css}" rel="stylesheet"/>
    <title>üòè Weather</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <script src="https://unpkg.com/htmx-ext-response-targets@2.0.2"></script>
    <script th:src="@{/scripts/js.js}"></script>
    <script th:src="@{/scripts/modal.js}"></script>
</head>

<body hx-ext="response-targets">

<h1>Advanced <s>programming</s> forecasting for Java platform</h1>
<hr>
<main>
    <!-- Countries -->
    <section id="section-country">
        <h2>Countries</h2>
        <form hx-put="/api/states"
              hx-ext="json-enc"
              hx-target="#response-country-ok"
              hx-target-error="#response-country-err"
              hx-on::before-request="clearResponseMessages();"
              hx-on::after-request="this.reset();refreshCountryList();"
        >
            <fieldset>
                <legend>Add country</legend>
                <label for="country-add-code">Country code:</label>
                <input type="text" id="country-add-code" name="stateId" maxlength="2"
                       oninput="this.value = this.value.toUpperCase();" required><br><br>
                <label for="country-add-name">Country name:</label>
                <input type="text" id="country-add-name" name="name" required><br><br>
                <button type="submit">Create</button>
            </fieldset>
        </form>
        <br>
        <div id="response-country-ok" class="response-ok">&nbsp;</div>
        <div id="response-country-err" class="response-err">&nbsp;</div>
        <br>
        <button hx-delete="/api/states"
                hx-target="#response-country-ok"
                hx-confirm="This will delete EVERYTHING due to cascade.&#10;&#10;Are you sure?"
                hx-on::before-request="clearResponseMessages();"
                hx-on::after-request="refreshCountryList();refreshCityList();"
        >
            DELETE ALL
        </button>
        <button
                hx-put="/api/states/testing"
                hx-target="#response-country-ok"
                hx-on::before-request="clearResponseMessages();"
                hx-on::after-request="refreshCountryList();"
        >
            Add testing data
        </button>
        <div id="list-country" hx-get="/web/states" hx-swap="innerHTML" hx-trigger="refreshCountryEvent"></div>
    </section>
    <!-- Cities -->
    <section id="section-city">
        <h2>Cities</h2>
        <form hx-put="/api/cities"
              hx-ext="json-enc"
              hx-target="#response-city-ok"
              hx-target-error="#response-city-err"
              hx-on::before-request="clearResponseMessages();"
              hx-on::after-request="this.reset();refreshCityList();"
        >
            <fieldset>
                <legend>Add city</legend>
                <label for="city-add-code">Country code:</label>
                <input type="text" id="city-add-code" name="stateId" maxlength="2"
                       oninput="this.value = this.value.toUpperCase();" required><br><br>
                <label for="city-add-name">&nbsp;&nbsp;&nbsp;City name:</label>
                <input type="text" id="city-add-name" name="cityName" required><br><br>
                <button type="submit">Create</button>
            </fieldset>
        </form>
        <br>
        <div id="response-city-ok" class="response-ok">&nbsp;</div>
        <div id="response-city-err" class="response-err">&nbsp;</div>
        <br>
        <button hx-delete="/api/cities"
                hx-target="#response-city-ok"
                hx-confirm="This will delete all cities and all weather reports.&#10;&#10;Are you sure?"
                hx-on::before-request="clearResponseMessages();"
                hx-on::after-request="refreshCityList();"
        >
            DELETE ALL
        </button>
        <button
                hx-put="/api/cities/testing"
                hx-target="#response-city-ok"
                hx-target-error="#response-city-err"
                hx-on::before-request="clearResponseMessages();"
                hx-on::after-request="refreshCityList();"
        >
            Add testing data
        </button>
        <div id="list-city" hx-get="/web/cities" hx-swap="innerHTML" hx-trigger="refreshCityEvent"></div>
    </section>
    <!-- Weather reports -->
    <section id="section-weather">
        <h2>Weather reports</h2>
        <form>
            <fieldset>
                <legend>Add weather report</legend>
                <label for="weather-add-code">City code:</label>
                <input type="text" id="weather-add-code"><br><br>
                <label for="weather-add-timestamp">Timestamp:</label>
                <input type="text" id="weather-add-timestamp"><br><br>
                <button type="submit">Submit</button>
            </fieldset>
        </form>
        <br>
        <div id="response-weather-ok" class="response-ok">&nbsp;</div>
        <div id="response-weather-err" class="response-err">&nbsp;</div>
        <br>
        <button>DELETE ALL (WIP)</button>
        <button>Add testing data (WIP)</button>
        <!--
        <div id="list-weather" hx-get="/web/weathers" hx-swap="innerHTML" hx-trigger="refreshWeatherEvent"></div>
        -->
    </section>
</main>

<!-- Country edit modal -->
<div id="modal-country" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit country</h3>
            <span id="modal-country-close" class="close">&times;</span>
        </div>
        <form
                hx-patch="/api/states"
                hx-ext="json-enc"
                hx-target="#response-country-ok"
                hx-target-error="#response-country-err"
                hx-on::before-request="clearResponseMessages();"
                hx-on::after-request="closeModals();refreshCountryList();"
        >
            <label for="country-edit-code">Country code:</label>
            <input type="text" id="country-edit-code" name="stateId" maxlength="2"
                   oninput="this.value = this.value.toUpperCase();" required readonly><br><br>
            <label for="country-edit-name">Country name:</label>
            <input type="text" id="country-edit-name" name="name" required><br><br>
            <button type="submit">Update</button>
        </form>
    </div>
</div>

</body>
</html>
